<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>MilnaGourmet</title>
    <base href="/" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" type="image/x-icon" href="favicon.ico" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css"
      integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxve5UMg5GT6L4JJg=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/flowbite@2.5.1/dist/flowbite.min.css"
      rel="stylesheet"
    />
  </head>
  <body>
    <app-root></app-root>

    <button
      id="scrollUpBtn"
      class="scroll-up-btn rounded-full px-2 py-1"
      aria-label="Retourner en haut de la page"
    >
      <i class="fa-solid fa-arrow-up-long"></i>
    </button>

    

    <script>
      // Constantes pour les sélecteurs fréquemment utilisés
      const SELECTORS = {
        scrollUpBtn: "#scrollUpBtn",
        modalConnexion: "#modalConnexion",
        modalInscription: "#modalInscription",
        modalLoginOublie: "#modalLoginOublie",
        profil: "#profil",
        modalProfil: "#modalProfil",
        compte: "#compte",
        compteDropdown: "#compteDropdown",
        cartButton: "#cartButton",
        cartDropdown: "#cartDropdown",
      };

      // Fonction pour faire défiler la page vers le haut
      function scrollToTop() {
        window.scrollTo({
          top: 0,
          behavior: "smooth",
        });
      }

      // Gestion de l'affichage du bouton de défilement
      function handleScrollButton() {
        const scrollUpBtn = document.querySelector(SELECTORS.scrollUpBtn);
        const shouldDisplay = document.documentElement.scrollTop > 20;
        scrollUpBtn.style.display = shouldDisplay ? "block" : "none";
      }

      // Fonction pour fermer un modal
      function closeModal(modalId) {
        document.getElementById(modalId).classList.add("hidden");
      }

      // Fonction pour basculer l'affichage d'un modal
      function toggleModal(modalId, show) {
        const modal = document.getElementById(modalId);
        if (modal) {
          modal.style.display = show ? "block" : "none";
        }
      }

      // Configuration des déclencheurs de modaux
      function setupModalTriggers() {
        const triggers = {
          loginModal: SELECTORS.modalConnexion,
          registerModal: SELECTORS.modalInscription,
          forgotPasswordModal: SELECTORS.modalLoginOublie,
        };

        Object.entries(triggers).forEach(([triggerId, modalId]) => {
          const trigger = document.getElementById(triggerId);
          if (trigger) {
            trigger.addEventListener("click", (event) => {
              event.preventDefault();
              toggleModal(modalId, true);
            });
          }
        });
      }

      // Configuration de la visibilité des modaux
      function setupModalVisibility(triggerId, modalId) {
        const trigger = document.getElementById(triggerId);
        const modal = document.getElementById(modalId);

        if (trigger && modal) {
          trigger.addEventListener("click", (event) => {
            event.preventDefault();
            modal.classList.remove("hidden");
          });

          document.addEventListener("click", (event) => {
            if (
              !trigger.contains(event.target) &&
              !modal.contains(event.target)
            ) {
              modal.classList.add("hidden");
            }
          });
        }
      }

      // Gestion du mot de passe oublié
      function setupForgotPassword() {
        const forgotPasswordModal = document.querySelector(
          SELECTORS.modalLoginOublie
        );
        const forgotPasswordLink =
          document.getElementById("forgotPasswordLink");
        const modalConnexion = document.querySelector(SELECTORS.modalConnexion);

        if (forgotPasswordLink && forgotPasswordModal && modalConnexion) {
          forgotPasswordLink.addEventListener("click", (event) => {
            event.preventDefault();
            modalConnexion.classList.add("hidden");
            forgotPasswordModal.classList.remove("hidden");
          });

          // Fermeture du modal en cliquant en dehors
          document.addEventListener("click", (event) => {
            if (
              !forgotPasswordLink.contains(event.target) &&
              !forgotPasswordModal.contains(event.target)
            ) {
              forgotPasswordModal.classList.add("hidden");
            }
          });
        }
      }

      // Configuration du dropdown du profil
      function setupProfileDropdown() {
        const profil = document.querySelector(SELECTORS.profil);
        const modalProfil = document.querySelector(SELECTORS.modalProfil);

        profil.addEventListener("click", () =>
          modalProfil.classList.remove("hidden")
        );

        document.addEventListener("click", (event) => {
          if (
            !profil.contains(event.target) &&
            !modalProfil.contains(event.target)
          ) {
            modalProfil.classList.add("hidden");
          }
        });
      }

      // Configuration du dropdown du compte
      function setupAccountDropdown() {
        const compte = document.querySelector(SELECTORS.compte);
        const compteDropdown = document.querySelector(SELECTORS.compteDropdown);

        compte.addEventListener("click", () =>
          compteDropdown.classList.remove("hidden")
        );

        document.addEventListener("click", (event) => {
          if (
            !compte.contains(event.target) &&
            !compteDropdown.contains(event.target)
          ) {
            compteDropdown.classList.add("hidden");
          }
        });
      }

      // Configuration du dropdown du panier
      function setupCartDropdown() {
        const cartButton = document.querySelector(SELECTORS.cartButton);
        const cartDropdown = document.querySelector(SELECTORS.cartDropdown);

        cartButton.addEventListener("click", () =>
          cartDropdown.classList.remove("hidden")
        );

        document.addEventListener("click", (event) => {
          if (
            !cartButton.contains(event.target) &&
            !cartDropdown.contains(event.target)
          ) {
            cartDropdown.classList.add("hidden");
          }
        });
      }

      // Fonction d'initialisation principale
      function initializeApp() {
        setupModalTriggers();
        setupModalVisibility("inscription", "modalInscription");
        setupModalVisibility("connexion", "modalConnexion");
        setupForgotPassword();
        setupProfileDropdown();
        setupAccountDropdown();
        setupCartDropdown();

        const scrollUpBtn = document.querySelector(SELECTORS.scrollUpBtn);
        if (scrollUpBtn) {
          scrollUpBtn.addEventListener("click", scrollToTop);
        }

        window.addEventListener("scroll", handleScrollButton);
      }

      // Exécuter l'initialisation lorsque le DOM est chargé
      document.addEventListener("DOMContentLoaded", initializeApp);
    </script>
    <script src="https://cdn.jsdelivr.net/npm/flowbite@2.5.1/dist/flowbite.min.js"></script>
    <script src="scripts.js"></script>
  </body>
</html>
